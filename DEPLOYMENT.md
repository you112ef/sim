# SimStudio Deployment Guide

This guide covers deploying SimStudio to Render.com.

## Prerequisites

- GitHub repository with the SimStudio code
- Render.com account
- PostgreSQL database (provided by Render)

## Render Deployment

### 1. Connect Repository to Render

1. Go to [Render Dashboard](https://dashboard.render.com)
2. Click "New +" â†’ "Web Service"
3. Connect your GitHub repository
4. Select the repository containing SimStudio

### 2. Configure Web Service

- **Name**: `simstudio` (or your preferred name)
- **Environment**: `Node`
- **Region**: `Oregon` (or your preferred region)
- **Branch**: `main` (or your deployment branch)
- **Root Directory**: Leave empty (uses root)
- **Build Command**: `./render-build.sh`
- **Start Command**: 
  ```bash
  export PATH="$HOME/.bun/bin:$PATH"
  cd apps/sim
  bun run start
  ```

### 3. Environment Variables

The following environment variables are automatically configured in `render.yaml`:

#### Required Variables (Auto-generated by Render):
- `DATABASE_URL` - Connected to PostgreSQL database
- `BETTER_AUTH_SECRET` - Auto-generated secret (32+ characters)
- `ENCRYPTION_KEY` - Auto-generated encryption key (32+ characters)
- `INTERNAL_API_SECRET` - Auto-generated API secret (32+ characters)

#### Security Variables (Pre-configured):
- `DATABASE_SSL` - Set to "require" for secure connections
- `ALLOWED_ORIGINS` - Configured for Render domain
- `RATE_LIMIT_WINDOW_MS` - Set to 60000 (1 minute)
- `RATE_LIMIT_FREE_SYNC` - Set to 10 requests per minute
- `RATE_LIMIT_FREE_ASYNC` - Set to 50 requests per minute
- `FREE_TIER_COST_LIMIT` - Set to 100 for free tier
- `LOG_LEVEL` - Set to "INFO" for production logging

#### Feature Flags (Pre-configured):
- `BILLING_ENABLED` - Set to "false" (disabled)
- `EMAIL_VERIFICATION_ENABLED` - Set to "false" (disabled)
- `POSTHOG_ENABLED` - Set to "false" (disabled)
- `NEXT_PUBLIC_EMAIL_PASSWORD_SIGNUP_ENABLED` - Set to "true" (enabled)

#### Optional Variables (Add manually in Render dashboard):
- `OPENAI_API_KEY` - For OpenAI integration
- `ANTHROPIC_API_KEY_1` - For Anthropic Claude integration
- `MISTRAL_API_KEY` - For Mistral AI integration
- `STRIPE_SECRET_KEY` - For payment processing
- `RESEND_API_KEY` - For email functionality
- `AWS_ACCESS_KEY_ID` - For S3 storage
- `AWS_SECRET_ACCESS_KEY` - For S3 storage
- `S3_BUCKET_NAME` - For S3 storage

### 4. Database Setup

1. In Render dashboard, create a new PostgreSQL database:
   - **Name**: `simstudio-db`
   - **Plan**: `Starter` (free tier)
   - **Region**: `Oregon` (same as web service)

2. The database connection will be automatically linked via `DATABASE_URL`

### 5. Deploy

1. Click "Create Web Service"
2. Render will automatically:
   - Install Bun
   - Install dependencies
   - Build the application
   - Start the service

### 6. Custom Domain (Optional)

1. Go to your web service settings
2. Click "Custom Domains"
3. Add your domain and configure DNS

## Local Development

### Prerequisites
- Bun 1.2.13+
- Node.js 20+
- PostgreSQL

### Setup

1. Clone the repository
2. Install dependencies:
   ```bash
   bun install
   ```

3. Copy environment variables:
   ```bash
   cp .env.example .env.local
   ```

4. Update `.env.local` with your configuration

5. Start development server:
   ```bash
   cd apps/sim
   bun run dev
   ```

## Docker Deployment

For Docker-based deployments, use the provided `Dockerfile`:

```bash
docker build -t simstudio .
docker run -p 3000:3000 simstudio
```

## Troubleshooting

### Build Issues
- Ensure Bun is properly installed
- Check that all dependencies are installed
- Verify environment variables are set correctly

### Database Issues
- Ensure PostgreSQL is running
- Check database connection string
- Verify database migrations have run

### Runtime Issues
- Check application logs in Render dashboard
- Verify all required environment variables are set
- Ensure the application is listening on the correct port

## Support

For issues related to:
- SimStudio application: Check the main repository issues
- Render deployment: Check Render documentation
- This deployment guide: Create an issue in this repository